# フェーズ3 動作確認手順

## 1. 事前準備

### 必要な環境
- **Java 17** (mise環境)
- **Node.js 22** (mise環境) 
- **Docker** (Valkey用)

### 環境確認
```powershell
# mise環境確認
mise current

# Docker確認
docker --version
```

## 2. サービス起動手順

### ターミナル1: Valkey起動
```powershell
# プロジェクトルートで実行
docker-compose -f docker-compose.yml -f docker-compose.dev.yml up valkey -d

# 起動確認
docker ps
```

### ターミナル2: バックエンド起動
```powershell
# プロジェクトルートで実行
cd backend
mise exec -- gradlew.bat bootRun
```
**期待される出力**: `Started SseLearnApplication in X.XXX seconds`

### ターミナル3: フロントエンド起動
```powershell
# プロジェクトルートで実行  
cd frontend
npm run dev
```
**期待される出力**: `Local: http://localhost:5173/`

## 3. 動作確認項目

### 3.1 基本表示確認
1. **ブラウザアクセス**: http://localhost:5173
2. **ページ構成確認**:
   - ✅ ヘッダー: 「🎥 SSE学習 - ライブ配信」
   - ✅ 左側: 動画モックエリア（黒背景・配信統計）
   - ✅ 右側: コメントサイドバー
   - ✅ フッター: 技術スタック情報

### 3.2 接続状態確認
- **初期状態**: 「🔄 接続中...」→「🟢 接続中」に変化
- **状態表示**: 右上のConnectionStatusコンポーネントで確認
- **期待動作**: 数秒でバックエンドSSE接続完了

### 3.3 コメント投稿テスト
1. **フォーム確認**:
   - ユーザー名入力欄
   - メッセージ入力欄  
   - 送信ボタン（両方入力時のみ有効化）

2. **投稿テスト**:
   - ユーザー名: `テストユーザー`
   - メッセージ: `Hello SSE!`
   - 送信ボタンクリック

3. **期待結果**:
   - ✅ フォームクリア
   - ✅ 新着コメントがリストに表示  
   - ✅ 「NEW」バッジ付きでアニメーション表示
   - ✅ 自動スクロール（最新コメントへ）

### 3.4 リアルタイム通信確認

#### 複数タブテスト
1. **新しいタブ**で http://localhost:5173 を開く
2. **タブ1**でコメント投稿
3. **タブ2**で即座にコメント受信確認

#### 複数ユーザーシミュレーション
```powershell
# PowerShell別ウィンドウで簡易テスト
curl -X POST http://localhost:8080/api/comments `
  -H "Content-Type: application/json" `
  -d '{"username":"API User","message":"API経由テスト"}'
```

### 3.5 UI/UX機能確認

#### レスポンシブデザイン
- **デスクトップ**: 2カラムレイアウト
- **タブレット**: F12 → 1024px幅で確認
- **モバイル**: F12 → 768px幅で1カラム表示確認

#### アクセシビリティ
- **キーボード操作**: Tab キーでフォーカス移動
- **コメントリスト**: Ctrl+Home（先頭）、Ctrl+End（最新）
- **スクリーンリーダー**: ChromeのAccessibility確認

#### エラー処理
1. **バックエンド停止**: Ctrl+C でバックエンド終了
2. **フロントエンド確認**: 「🔴 接続エラー」表示
3. **再接続**: 再接続ボタンクリック
4. **バックエンド再起動**: `mise exec -- gradlew.bat bootRun`

## 4. 開発者ツール確認

### ブラウザ開発者ツール（F12）
```javascript
// Console確認項目
// 1. SSE接続ログ
"Live streaming page: SSE connection started"

// 2. コメント受信ログ  
"CommentSseManager: Comment received"

// 3. エラーログ（あれば）
// エラーが無いことを確認
```

### ネットワークタブ確認
1. **SSE接続**: `http://localhost:8080/api/sse/comments`
2. **POST送信**: `http://localhost:8080/api/comments` 
3. **ステータス**: 全て2xx成功確認

## 5. パフォーマンステスト

### 連続投稿テスト
```powershell
# 10件連続投稿テスト
for ($i=1; $i -le 10; $i++) {
    curl -X POST http://localhost:8080/api/comments `
      -H "Content-Type: application/json" `
      -d "{`"username`":`"User$i`",`"message`":`"メッセージ $i`"}"
    Start-Sleep -Milliseconds 500
}
```

### 期待結果
- ✅ 全コメント即座に表示
- ✅ アニメーション正常動作  
- ✅ スクロール追従動作
- ✅ メモリリーク無し

## 6. トラブルシューティング

### よくある問題

#### 1. バックエンド起動失敗
```
エラー: Java 11 JVM detected
解決: mise exec -- gradlew.bat bootRun を使用
```

#### 2. フロントエンド接続失敗
```
エラー: CORS エラー
解決: バックエンドが http://localhost:8080 で起動確認
```

#### 3. Valkey接続失敗
```
エラー: Connection refused
解決: docker-compose up valkey -d で起動確認
```

### ログ確認コマンド
```powershell
# バックエンドログ確認
# ターミナル2の出力を確認

# Valkeyログ確認  
docker logs sse-learn-valkey

# フロントエンドログ確認
# ブラウザ開発者ツールConsole確認
```

## 7. 完了確認チェックリスト

- [ ] 3つのサービス正常起動（Valkey、バックエンド、フロントエンド）
- [ ] SSE接続成功（🟢 接続中 表示）
- [ ] コメント投稿→即座受信確認
- [ ] 複数タブでリアルタイム同期確認  
- [ ] レスポンシブデザイン動作確認
- [ ] エラーハンドリング動作確認
- [ ] パフォーマンス問題なし

全項目クリア後、フェーズ3の動作確認完了です！🎉